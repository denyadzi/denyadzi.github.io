
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Triggering External Interrupt on Stm32f4discovery - Blog on embedded programming</title>
  <meta name="author" content="Dzianis Yatskevich">

  
  <meta name="description" content="Hello everyone! This post introduces stm32f4xx interrupts and their usage from assembly language. The goal is to react on user-button push (a blue &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://denyadzi.github.io/blog/2014/12/30/triggering-external-interrupt-on-stm32f4discovery">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Blog on embedded programming" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Blog on embedded programming</a></h1>
  
    <h2>The trip to the dark side</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:denyadzi.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Triggering External Interrupt on Stm32f4discovery</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-30T08:26:35+03:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:26 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Hello everyone! This post introduces stm32f4xx interrupts and their usage from assembly language. The goal is to react on user-button push (a blue one) using external interrupt. To reach this goal without involving the interrupt we would write a loop &ldquo;listening&rdquo; the input level on the pin. That&rsquo;s a really bad idea because our application should be able to do other useful stuff.</p>

<p>A usual application configures all needed interrupts, peripherals etc. at init stage an then just falls into infinite loop that does nothing - or even it may go to a sleep mode, waking up just to process events and after that go to sleep again.</p>

<!--more-->


<p>To introduce an external interrupt I configure port&rsquo;s A zero pin as input with pulldown resistor. Connecting pulldown resistor guarantees low level at the pin when button is not pressed. Then I configure this pin as the source for external interrupt line 0 - stm32f4xx has a rather flexible external interrupt system (please, refer the user manual). After that additionally I need to mask which lines can generate an interrupt request - in our case it is line 0.</p>

<p>The &ldquo;master&rdquo; of all interrupts and events inside stm32 is the NVIC core peripheral (please refer to <a href="http://www.st.com/st-web-ui/static/active/en/resource/technical/document/programming_manual/DM00046982.pdf">stm32 programming manual</a> - which is a very useful resource). To get things work I should enable the interrupt coming from channel EXT0_IRQn = 6 (this information is summarized in the interrupt vector table, see <a href="http://www.st.com/st-web-ui/static/active/en/resource/technical/document/reference_manual/DM00031020.pdf">stm32 reference manual, page 371</a>. Finally I associate some routine to be an interrupt handler by placing it&rsquo;s address to appropriate offset within interrupt vector table.</p>

<p>Let&rsquo;s beging coding. Code for startup and init_clock routines I&rsquo;ve taken from <a href="/blog/2014/12/27/clock-control-on-stm32f4discovery/">clock control on stm32f4discovery</a> post. So, the clock source is HSE with 8 MHz crystal. No PLL is used.</p>

<p>I&rsquo;ve decided to share for you two variants of code working with the user button. While I was struggling to make the external interrupt work I wrote a code which works with the user button through a usual loop as a starting point.</p>

<p>Here it is. Now, I&rsquo;m trying to be modular while writing code. Defined constants are included below.</p>

<figure class='code'><figcaption><span> (external_interrupt.S)</span> <a href='/public/code/external_interrupt/external_interrupt.S'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
</pre></td><td class='code'><pre><code class='Gas'><span class='line'>    <span class="na">.thumb</span>
</span><span class='line'>    <span class="na">.syntax</span>     <span class="no">unified</span>
</span><span class='line'>    <span class="na">.cpu</span>        <span class="no">cortex-m4</span>
</span><span class='line'>
</span><span class='line'>    <span class="na">.include</span>    <span class="s">&quot;registers_and_bits.inc.S&quot;</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">DELAY</span><span class="p">,</span>                  <span class="mi">0x1</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="na">.section</span>        <span class="no">.text</span>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">_reset</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">_reset:</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">startup</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">init_clock</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">gpio_setup</span>
</span><span class='line'>    <span class="nf">b</span>           <span class="no">run</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">_reset</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">_reset</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">run</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">run:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">GPIOD_ODR</span>          <span class="err">/</span><span class="p">*</span> <span class="no">port</span> <span class="no">D</span> <span class="no">output</span> <span class="no">register</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r3</span><span class="p">,</span> <span class="err">=</span><span class="no">GPIOA_IDR</span>          <span class="err">/</span><span class="p">*</span> <span class="no">port</span> <span class="no">A</span> <span class="no">input</span> <span class="no">register</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'><span class="err">2:</span>
</span><span class='line'>    <span class="nf">eor</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">r1</span>                  <span class="err">/</span><span class="p">*</span> <span class="no">elegant</span> <span class="no">way</span> <span class="no">to</span> <span class="no">clean</span> <span class="no">register</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">all</span> <span class="no">LEDs</span> <span class="no">on</span> <span class="no">GPIOD_ODR</span> <span class="no">off</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r4</span><span class="p">,</span> <span class="err">[</span><span class="no">r3</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">reading</span> <span class="no">port</span> <span class="no">A</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="no">ands</span>        <span class="no">r4</span><span class="p">,</span> <span class="no">IDR0</span>                <span class="err">/</span><span class="p">*</span> <span class="no">when</span> <span class="no">button</span> <span class="no">is</span> <span class="no">pressed</span> <span class="p">-</span> <span class="no">high</span> <span class="no">level</span> <span class="no">appears</span> <span class="no">at</span> <span class="no">pin</span> <span class="mi">0</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">beq</span>         <span class="mi">1</span><span class="no">b</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">super_flash</span>           <span class="err">/</span><span class="p">*</span> <span class="no">make</span> <span class="no">a</span> <span class="no">flash</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r4</span><span class="p">,</span> <span class="err">[</span><span class="no">r3</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">and</span> <span class="no">wait</span> <span class="no">for</span> <span class="no">button</span> <span class="no">release</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ands</span>        <span class="no">r4</span><span class="p">,</span> <span class="no">IDR0</span>
</span><span class='line'>    <span class="nf">bne</span>         <span class="mi">1</span><span class="no">b</span>
</span><span class='line'>    <span class="nf">b</span>           <span class="mi">2</span><span class="no">b</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">run</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">run</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">super_flash</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">super_flash:</span>
</span><span class='line'>    <span class="nf">push</span>        <span class="err">{</span><span class="no">lr</span><span class="err">}</span>                    <span class="err">/</span><span class="p">*</span> <span class="no">we</span> <span class="no">need</span> <span class="no">to</span> <span class="no">preserve</span> <span class="no">the</span> <span class="no">return</span> <span class="no">address</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r5</span><span class="p">,</span> <span class="mi">5</span>                   <span class="err">/</span><span class="p">*</span> <span class="no">as</span> <span class="no">this</span> <span class="no">routine</span> <span class="no">is</span> <span class="no">going</span> <span class="no">to</span> <span class="no">call</span> <span class="no">a</span> <span class="no">subroutine</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">LED_GREEN</span>           <span class="err">/</span><span class="p">*</span> <span class="no">flashing</span> <span class="no">one</span> <span class="no">by</span> <span class="no">one</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">flash_led</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">LED_BLUE</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">flash_led</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">LED_RED</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">flash_led</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">LED_ORANGE</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">flash_led</span>
</span><span class='line'>    <span class="nf">subs</span>        <span class="no">r5</span><span class="p">,</span> <span class="mi">1</span>                   <span class="err">/</span><span class="p">*</span> <span class="err">&lt;</span><span class="no">r5</span><span class="err">&gt;</span> <span class="no">times</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bne</span>         <span class="mi">1</span><span class="no">b</span>
</span><span class='line'>    <span class="nf">pop</span>         <span class="err">{</span><span class="no">lr</span><span class="err">}</span>                    <span class="err">/</span><span class="p">*</span> <span class="no">restore</span> <span class="no">the</span> <span class="no">return</span> <span class="no">address</span> <span class="no">and</span> <span class="no">jump</span> <span class="no">to</span> <span class="no">it</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">super_flash</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">super_flash</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">flash_led</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">flash_led:</span>
</span><span class='line'>    <span class="nf">push</span>        <span class="err">{</span><span class="no">lr</span><span class="err">}</span>                    <span class="err">/</span><span class="p">*</span> <span class="no">in</span> <span class="no">this</span> <span class="no">function</span> <span class="no">it</span> <span class="no">is</span> <span class="no">assumed</span> <span class="no">that</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">r0</span> <span class="no">contains</span> <span class="no">port</span> <span class="no">D</span> <span class="no">address</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">delay</span>                 <span class="err">/</span><span class="p">*</span> <span class="no">and</span> <span class="no">r1</span> <span class="no">contains</span> <span class="no">the</span> <span class="no">LED</span> <span class="no">bit</span> <span class="no">to</span> <span class="no">be</span> <span class="no">flashed</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">eor</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">r1</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">LED</span> <span class="no">fade</span> <span class="no">out</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">delay</span>
</span><span class='line'>    <span class="nf">pop</span>         <span class="err">{</span><span class="no">lr</span><span class="err">}</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">flash_led</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">flash_led</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">delay</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">delay:</span>
</span><span class='line'>    <span class="nf">movt</span>        <span class="no">r2</span><span class="p">,</span> <span class="no">DELAY</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">subs</span>        <span class="no">r2</span><span class="p">,</span> <span class="no">r2</span><span class="p">,</span> <span class="mi">1</span>               <span class="err">/</span><span class="p">*</span> <span class="no">spend</span> <span class="no">time</span> <span class="no">substracting</span> <span class="no">DELAY</span> <span class="no">value</span> <span class="no">by</span> <span class="mi">1</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bne</span>         <span class="mi">1</span><span class="no">b</span>                      <span class="err">/</span><span class="p">*</span> <span class="err">&#39;</span><span class="mi">1</span><span class="no">b</span><span class="err">&#39;</span> <span class="no">means</span> <span class="err">`</span><span class="no">look</span> <span class="no">backward</span> <span class="no">for</span> <span class="no">label</span> <span class="err">&#39;</span><span class="mi">1</span><span class="err">&#39;`</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">delay</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">delay</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">gpio_setup</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">gpio_setup:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_AHB1ENR</span>        <span class="err">/</span><span class="p">*</span> <span class="no">this</span> <span class="no">register</span> <span class="no">controls</span> <span class="no">some</span> <span class="no">amount</span> <span class="no">of</span> <span class="no">peripherals</span><span class="err">&#39;</span> <span class="no">clock</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">GPIODEN</span> <span class="err">|</span> <span class="no">GPIOAEN</span>   <span class="err">/</span><span class="p">*</span> <span class="no">enabling</span> <span class="no">GPIOD</span> <span class="no">AND</span> <span class="no">GPIOA</span> <span class="no">clock</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">GPIOA_MODER</span>        <span class="err">/</span><span class="p">*</span> <span class="no">configure</span> <span class="no">GPIOA</span> <span class="no">as</span> <span class="no">input</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">bic</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">MODER0_IN</span>
</span><span class='line'>    <span class="no">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">GPIOA_PUPDR</span>        <span class="err">/</span><span class="p">*</span> <span class="no">connect</span> <span class="no">pulldown</span> <span class="no">resistor</span> <span class="no">to</span> <span class="no">the</span> <span class="no">pin</span> <span class="mi">0</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">PUPDR0_PD</span>
</span><span class='line'>    <span class="no">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">GPIOD_MODER</span>        <span class="err">/</span><span class="p">*</span> <span class="no">GPIOD</span> <span class="no">mode</span> <span class="no">configuration</span> <span class="no">register</span> <span class="p">-</span> <span class="no">all</span> <span class="no">LED</span> <span class="no">pins</span> <span class="no">are</span> <span class="no">outputs</span><span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">=</span><span class="no">MODER12_OUT</span> <span class="err">|</span> <span class="no">MODER13_OUT</span> <span class="err">|</span> <span class="no">MODER14_OUT</span> <span class="err">|</span> <span class="no">MODER15_OUT</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">gpio_setup</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">gpio_setup</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">startup</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">startup:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CR</span>             <span class="err">/</span><span class="p">*</span> <span class="no">resetting</span> <span class="no">clock</span> <span class="no">configuration</span> <span class="no">to</span> <span class="no">it</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">defaults</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">clearing</span> <span class="no">HSEON</span><span class="p">,</span> <span class="no">CSSON</span><span class="p">,</span> <span class="no">PLLON</span> <span class="no">bits</span> <span class="p">-</span> <span class="no">directly</span> <span class="no">disabling</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>                                        <span class="err">/*</span> <span class="nf">HSE</span> <span class="no">oscillator</span><span class="p">,</span> <span class="no">clock</span> <span class="no">security</span> <span class="no">system</span><span class="p">,</span> <span class="no">main</span> <span class="no">PLL</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">HSION</span>               <span class="err">/</span><span class="p">*</span> <span class="no">setting</span> <span class="no">HSION</span> <span class="no">bit</span> <span class="p">-</span> <span class="no">directly</span> <span class="no">selecting</span> <span class="no">HSI</span> <span class="no">oscillator</span><span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r2</span><span class="p">,</span> <span class="err">=</span><span class="p">(</span><span class="no">HSEON</span><span class="p">)</span> <span class="err">|</span> <span class="p">(</span><span class="no">CSSON</span><span class="p">)</span> <span class="err">|</span> <span class="p">(</span><span class="no">PLLON</span><span class="p">)</span>
</span><span class='line'>    <span class="nf">bic</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">r2</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CFGR</span>           <span class="err">/</span><span class="p">*</span> <span class="no">clearing</span> <span class="no">RCC_CFGR</span> <span class="p">-</span> <span class="no">clock</span> <span class="no">configuration</span> <span class="no">register</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">movw</span>        <span class="no">r1</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CIR</span>            <span class="err">/</span><span class="p">*</span> <span class="no">disabling</span> <span class="no">all</span> <span class="no">interrupts</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_PLLCFGR</span>        <span class="err">/</span><span class="p">*</span> <span class="no">setting</span> <span class="no">the</span> <span class="no">default</span> <span class="no">value</span> <span class="no">from</span> <span class="no">datasheet</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">=</span><span class="mi">0x24003010</span>         <span class="err">/</span><span class="p">*</span> <span class="no">for</span> <span class="no">PLL</span> <span class="no">configuration</span> <span class="no">register</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">startup</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">startup</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">init_clock</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">init_clock:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CR</span>             <span class="err">/</span><span class="p">*</span> <span class="no">enabling</span> <span class="no">HSE</span> <span class="no">clock</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">bic</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">HSEBYP</span>              <span class="err">/</span><span class="p">*</span> <span class="no">clearing</span> <span class="no">HSEBYP</span> <span class="no">bit</span> <span class="p">-</span> <span class="no">not</span> <span class="no">bypassing</span> <span class="no">HSE</span> <span class="no">oscillator</span><span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">HSEON</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">waiting</span> <span class="no">for</span> <span class="no">HSE</span> <span class="no">to</span> <span class="no">be</span> <span class="no">ready</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ands</span>        <span class="no">r1</span><span class="p">,</span> <span class="no">HSERDY</span>
</span><span class='line'>    <span class="nf">beq</span>         <span class="mi">1</span><span class="no">b</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CFGR</span>           <span class="err">/</span><span class="p">*</span> <span class="no">selecting</span> <span class="no">HSE</span> <span class="no">as</span> <span class="no">the</span> <span class="no">source</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">movw</span>        <span class="no">r1</span><span class="p">,</span> <span class="no">SW0</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">eor</span>         <span class="no">r2</span><span class="p">,</span> <span class="no">r2</span>
</span><span class='line'>    <span class="nf">movt</span>        <span class="no">r2</span><span class="p">,</span> <span class="no">HSE_STARTUP_TIMEOUT</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">waiting</span> <span class="no">for</span> <span class="no">source</span> <span class="no">being</span> <span class="no">selected</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">subs</span>        <span class="no">r2</span><span class="p">,</span> <span class="mi">1</span>                   <span class="err">/</span><span class="p">*</span> <span class="no">counting</span> <span class="no">some</span> <span class="no">HSE_STARTUP_TIMEOUT</span> <span class="no">value</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">beq</span>         <span class="mi">2</span><span class="no">f</span>                      <span class="err">/</span><span class="p">*</span> <span class="no">if</span> <span class="no">HSE</span> <span class="no">doesn</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">start</span> <span class="p">-</span> <span class="no">remain</span> <span class="no">with</span> <span class="no">HSI</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">and</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">RCC_CFGR_SWS</span>
</span><span class='line'>    <span class="nf">cmp</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">SWS0</span>
</span><span class='line'>    <span class="nf">bne</span>         <span class="mi">1</span><span class="no">b</span>
</span><span class='line'><span class="err">2:</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">init_clock</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">init_clock</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="na">.section</span>        <span class="no">.int_vector_table</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="err">%</span><span class="no">progbits</span>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">basic_vectors</span><span class="p">,</span> <span class="err">%</span><span class="no">object</span>
</span><span class='line'><span class="nl">basic_vectors:</span>
</span><span class='line'>    <span class="na">.word</span>       <span class="no">_estack</span>
</span><span class='line'>    <span class="na">.word</span>       <span class="no">_reset</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">basic_vectors</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">basic_vectors</span>
</span></code></pre></td></tr></table></div></figure>


<p>The executable is free to <a href="/public/code/external_interrupt/external_interrupt.bin">download</a>. Hope you will get that nice flashing on button pushed.</p>

<p>But as I said earlier that is a bad idea of application design. This code idea is narrow and tied up. We need to use a mini operating system approach not to be tied up. What is it about? The system boots, enables and configures some services needed and then just waits for events. The next code example is exactly about that. Note the <code>b     .</code> line which means &ldquo;jump at current address&rdquo; - the endless loop. After button is pushed the core will jump to _exti_0 and after execution return back to this loop. Whenever a new functionality is needed - it&rsquo;s easy enough to attach it.</p>

<p>Here is the code and defined constants.</p>

<figure class='code'><figcaption><span> (external_interrupt_1.S)</span> <a href='/public/code/external_interrupt/external_interrupt_1.S'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
</pre></td><td class='code'><pre><code class='Gas'><span class='line'>    <span class="na">.thumb</span>
</span><span class='line'>    <span class="na">.syntax</span>     <span class="no">unified</span>
</span><span class='line'>    <span class="na">.cpu</span>        <span class="no">cortex-m4</span>
</span><span class='line'>
</span><span class='line'>    <span class="na">.include</span>    <span class="s">&quot;registers_and_bits.inc.S&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">DELAY</span><span class="p">,</span>                  <span class="mi">0x1</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="na">.section</span>        <span class="no">.text</span>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">_reset</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">_reset:</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">startup</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">init_clock</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">gpio_setup</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">exti_setup</span>
</span><span class='line'>    <span class="nf">b</span>           <span class="p">.</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">_reset</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">_reset</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">_exti_0</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">_exti_0:</span>
</span><span class='line'>    <span class="nf">push</span>        <span class="err">{</span><span class="no">r0</span><span class="p">,</span><span class="no">r1</span><span class="p">,</span><span class="no">lr</span><span class="err">}</span>              <span class="err">/</span><span class="p">*</span> <span class="no">preserve</span> <span class="no">registers</span> <span class="no">being</span> <span class="no">used</span> <span class="no">by</span> <span class="no">routine</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">GPIOD_ODR</span>
</span><span class='line'>    <span class="nf">eor</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">r1</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">super_flash</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">EXTI_PR</span>            <span class="err">/</span><span class="p">*</span> <span class="no">after</span> <span class="no">we</span> <span class="no">do</span> <span class="no">nececcary</span> <span class="no">stuff</span> <span class="no">pending</span> <span class="no">bit</span> <span class="no">for</span> <span class="no">current</span> <span class="no">interrupt</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">should</span> <span class="no">be</span> <span class="no">cleared</span> <span class="no">and</span> <span class="no">this</span> <span class="no">is</span> <span class="no">done</span> <span class="no">by</span> <span class="no">setting</span> <span class="no">that</span> <span class="no">bit</span> <span class="no">to</span> <span class="mi">1</span><span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">PR0</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">pop</span>         <span class="err">{</span><span class="no">r0</span><span class="p">,</span><span class="no">r1</span><span class="p">,</span><span class="no">lr</span><span class="err">}</span>              <span class="err">/</span><span class="p">*</span> <span class="no">restore</span> <span class="no">registers</span> <span class="no">before</span> <span class="no">leave</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">_exti_0</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">_exti_0</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">exti_setup</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">exti_setup:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_APB2ENR</span>        <span class="err">/</span><span class="p">*</span> <span class="no">enable</span> <span class="no">syscfg</span> <span class="no">to</span> <span class="no">be</span> <span class="no">able</span> <span class="no">to</span> <span class="no">configure</span> <span class="no">external</span> <span class="no">interrupt</span> <span class="no">line</span> <span class="no">source</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">SYSCFGEN</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">SYSCFG_EXTICR1</span>     <span class="err">/</span><span class="p">*</span> <span class="no">choosing</span> <span class="no">PA0</span> <span class="no">as</span> <span class="no">a</span> <span class="no">source</span> <span class="no">for</span> <span class="no">ext.</span> <span class="no">interrupt</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">bic</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">SYSCFG_EXTICR1_EXTI0</span>
</span><span class='line'>    <span class="no">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">EXTI_IMR</span>           <span class="err">/</span><span class="p">*</span> <span class="no">setting</span> <span class="no">interrupt</span> <span class="no">mask</span> <span class="no">for</span> <span class="no">line</span> <span class="mi">0</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">movw</span>        <span class="no">r1</span><span class="p">,</span> <span class="no">MR0</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">EXTI_RTSR</span>          <span class="err">/</span><span class="p">*</span> <span class="no">configuring</span> <span class="no">interrupt</span> <span class="no">to</span> <span class="no">be</span> <span class="no">generated</span> <span class="no">on</span> <span class="no">rising</span> <span class="no">edge</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">movw</span>        <span class="no">r1</span><span class="p">,</span> <span class="no">TR0</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">NVIC_ISER0</span>         <span class="err">/</span><span class="p">*</span> <span class="no">enable</span> <span class="no">enterrupt</span> <span class="no">from</span> <span class="no">EXTI0_IRQn</span> <span class="no">channel</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">=</span><span class="no">SETENA6</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">exti_setup</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">exti_setup</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">super_flash</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">super_flash:</span>
</span><span class='line'>    <span class="nf">push</span>        <span class="err">{</span><span class="no">r1</span><span class="p">,</span> <span class="no">r5</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>            <span class="err">/</span><span class="p">*</span> <span class="no">we</span> <span class="no">need</span> <span class="no">to</span> <span class="no">preserve</span> <span class="no">the</span> <span class="no">return</span> <span class="no">address</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r5</span><span class="p">,</span> <span class="mi">5</span>                   <span class="err">/</span><span class="p">*</span> <span class="no">as</span> <span class="no">this</span> <span class="no">routine</span> <span class="no">is</span> <span class="no">going</span> <span class="no">to</span> <span class="no">call</span> <span class="no">a</span> <span class="no">subroutine</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">LED_GREEN</span>           <span class="err">/</span><span class="p">*</span> <span class="no">flashing</span> <span class="no">one</span> <span class="no">by</span> <span class="no">one</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">flash_led</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">LED_BLUE</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">flash_led</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">LED_RED</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">flash_led</span>
</span><span class='line'>    <span class="nf">mov</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">LED_ORANGE</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">flash_led</span>
</span><span class='line'>    <span class="nf">subs</span>        <span class="no">r5</span><span class="p">,</span> <span class="mi">1</span>                   <span class="err">/</span><span class="p">*</span> <span class="err">&lt;</span><span class="no">r5</span><span class="err">&gt;</span> <span class="no">times</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bne</span>         <span class="mi">1</span><span class="no">b</span>
</span><span class='line'>    <span class="nf">pop</span>         <span class="err">{</span><span class="no">r1</span><span class="p">,</span> <span class="no">r5</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>            <span class="err">/</span><span class="p">*</span> <span class="no">restore</span> <span class="no">the</span> <span class="no">return</span> <span class="no">address</span> <span class="no">and</span> <span class="no">jump</span> <span class="no">to</span> <span class="no">it</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">super_flash</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">super_flash</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">flash_led</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">flash_led:</span>
</span><span class='line'>    <span class="nf">push</span>        <span class="err">{</span><span class="no">r1</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>                <span class="err">/</span><span class="p">*</span> <span class="no">in</span> <span class="no">this</span> <span class="no">function</span> <span class="no">it</span> <span class="no">is</span> <span class="no">assumed</span> <span class="no">that</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">r0</span> <span class="no">contains</span> <span class="no">port</span> <span class="no">D</span> <span class="no">output</span> <span class="no">register</span> <span class="no">address</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">delay</span>                   <span class="err">/</span><span class="p">*</span> <span class="no">and</span> <span class="no">r1</span> <span class="no">contains</span> <span class="no">the</span> <span class="no">LED</span> <span class="no">bit</span> <span class="no">to</span> <span class="no">be</span> <span class="no">flashed</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">eor</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">r1</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">LED</span> <span class="no">fade</span> <span class="no">out</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bl</span>          <span class="no">delay</span>
</span><span class='line'>    <span class="nf">pop</span>         <span class="err">{</span><span class="no">r1</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">flash_led</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">flash_led</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">delay</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">delay:</span>
</span><span class='line'>    <span class="nf">push</span>        <span class="err">{</span><span class="no">r2</span><span class="err">}</span>
</span><span class='line'>    <span class="nf">movt</span>        <span class="no">r2</span><span class="p">,</span> <span class="no">DELAY</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">subs</span>        <span class="no">r2</span><span class="p">,</span> <span class="no">r2</span><span class="p">,</span> <span class="mi">1</span>               <span class="err">/</span><span class="p">*</span> <span class="no">spend</span> <span class="no">time</span> <span class="no">substracting</span> <span class="no">DELAY</span> <span class="no">value</span> <span class="no">by</span> <span class="mi">1</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">bne</span>         <span class="mi">1</span><span class="no">b</span>                      <span class="err">/</span><span class="p">*</span> <span class="err">&#39;</span><span class="mi">1</span><span class="no">b</span><span class="err">&#39;</span> <span class="no">means</span> <span class="err">`</span><span class="no">look</span> <span class="no">backward</span> <span class="no">for</span> <span class="no">label</span> <span class="err">&#39;</span><span class="mi">1</span><span class="err">&#39;`</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">pop</span>         <span class="err">{</span><span class="no">r2</span><span class="err">}</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">delay</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">delay</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">gpio_setup</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">gpio_setup:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_AHB1ENR</span>        <span class="err">/</span><span class="p">*</span> <span class="no">this</span> <span class="no">register</span> <span class="no">controls</span> <span class="no">some</span> <span class="no">amount</span> <span class="no">of</span> <span class="no">peripherals</span><span class="err">&#39;</span> <span class="no">clock</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">GPIODEN</span> <span class="err">|</span> <span class="no">GPIOAEN</span>   <span class="err">/</span><span class="p">*</span> <span class="no">enabling</span> <span class="no">GPIOD</span> <span class="no">AND</span> <span class="no">GPIOA</span> <span class="no">clock</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">GPIOA_MODER</span>        <span class="err">/</span><span class="p">*</span> <span class="no">configure</span> <span class="no">GPIOA</span> <span class="no">as</span> <span class="no">input</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">bic</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">MODER0_IN</span>
</span><span class='line'>    <span class="no">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">GPIOA_PUPDR</span>        <span class="err">/</span><span class="p">*</span> <span class="no">connect</span> <span class="no">pulldown</span> <span class="no">resistor</span> <span class="no">to</span> <span class="no">the</span> <span class="no">pin</span> <span class="mi">0</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">PUPDR0_PD</span>
</span><span class='line'>    <span class="no">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">GPIOD_MODER</span>        <span class="err">/</span><span class="p">*</span> <span class="no">GPIOD</span> <span class="no">mode</span> <span class="no">configuration</span> <span class="no">register</span> <span class="p">-</span> <span class="no">all</span> <span class="no">LED</span> <span class="no">pins</span> <span class="no">are</span> <span class="no">outputs</span><span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">=</span><span class="no">MODER12_OUT</span> <span class="err">|</span> <span class="no">MODER13_OUT</span> <span class="err">|</span> <span class="no">MODER14_OUT</span> <span class="err">|</span> <span class="no">MODER15_OUT</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">gpio_setup</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">gpio_setup</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">startup</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">startup:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CR</span>             <span class="err">/</span><span class="p">*</span> <span class="no">resetting</span> <span class="no">clock</span> <span class="no">configuration</span> <span class="no">to</span> <span class="no">it</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">defaults</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">clearing</span> <span class="no">HSEON</span><span class="p">,</span> <span class="no">CSSON</span><span class="p">,</span> <span class="no">PLLON</span> <span class="no">bits</span> <span class="p">-</span> <span class="no">directly</span> <span class="no">disabling</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>                                        <span class="err">/*</span> <span class="nf">HSE</span> <span class="no">oscillator</span><span class="p">,</span> <span class="no">clock</span> <span class="no">security</span> <span class="no">system</span><span class="p">,</span> <span class="no">main</span> <span class="no">PLL</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">HSION</span>               <span class="err">/</span><span class="p">*</span> <span class="no">setting</span> <span class="no">HSION</span> <span class="no">bit</span> <span class="p">-</span> <span class="no">directly</span> <span class="no">selecting</span> <span class="no">HSI</span> <span class="no">oscillator</span><span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r2</span><span class="p">,</span> <span class="err">=</span><span class="no">HSEON</span> <span class="err">|</span> <span class="no">CSSON</span> <span class="err">|</span> <span class="no">PLLON</span>
</span><span class='line'>    <span class="nf">bic</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">r2</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CFGR</span>           <span class="err">/</span><span class="p">*</span> <span class="no">clearing</span> <span class="no">RCC_CFGR</span> <span class="p">-</span> <span class="no">clock</span> <span class="no">configuration</span> <span class="no">register</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">movw</span>        <span class="no">r1</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CIR</span>            <span class="err">/</span><span class="p">*</span> <span class="no">disabling</span> <span class="no">all</span> <span class="no">interrupts</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_PLLCFGR</span>        <span class="err">/</span><span class="p">*</span> <span class="no">setting</span> <span class="no">the</span> <span class="no">default</span> <span class="no">value</span> <span class="no">from</span> <span class="no">datasheet</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">=</span><span class="mi">0x24003010</span>         <span class="err">/</span><span class="p">*</span> <span class="no">for</span> <span class="no">PLL</span> <span class="no">configuration</span> <span class="no">register</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">startup</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">startup</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">init_clock</span><span class="p">,</span> <span class="err">%</span><span class="no">function</span>
</span><span class='line'><span class="nl">init_clock:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CR</span>             <span class="err">/</span><span class="p">*</span> <span class="no">enabling</span> <span class="no">HSE</span> <span class="no">clock</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">bic</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">HSEBYP</span>              <span class="err">/</span><span class="p">*</span> <span class="no">clearing</span> <span class="no">HSEBYP</span> <span class="no">bit</span> <span class="p">-</span> <span class="no">not</span> <span class="no">bypassing</span> <span class="no">HSE</span> <span class="no">oscillator</span><span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">orr</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">HSEON</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">waiting</span> <span class="no">for</span> <span class="no">HSE</span> <span class="no">to</span> <span class="no">be</span> <span class="no">ready</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">ands</span>        <span class="no">r1</span><span class="p">,</span> <span class="no">HSERDY</span>
</span><span class='line'>    <span class="nf">beq</span>         <span class="mi">1</span><span class="no">b</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="no">RCC_CFGR</span>           <span class="err">/</span><span class="p">*</span> <span class="no">selecting</span> <span class="no">HSE</span> <span class="no">as</span> <span class="no">the</span> <span class="no">source</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">movw</span>        <span class="no">r1</span><span class="p">,</span> <span class="no">SW0</span>
</span><span class='line'>    <span class="nf">str</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>
</span><span class='line'>    <span class="nf">eor</span>         <span class="no">r2</span><span class="p">,</span> <span class="no">r2</span>
</span><span class='line'>    <span class="nf">movt</span>        <span class="no">r2</span><span class="p">,</span> <span class="no">HSE_STARTUP_TIMEOUT</span>
</span><span class='line'><span class="err">1:</span>
</span><span class='line'>    <span class="nf">ldr</span>         <span class="no">r1</span><span class="p">,</span> <span class="err">[</span><span class="no">r0</span><span class="err">]</span>                <span class="err">/</span><span class="p">*</span> <span class="no">waiting</span> <span class="no">for</span> <span class="no">source</span> <span class="no">being</span> <span class="no">selected</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">subs</span>        <span class="no">r2</span><span class="p">,</span> <span class="mi">1</span>                   <span class="err">/</span><span class="p">*</span> <span class="no">counting</span> <span class="no">some</span> <span class="no">HSE_STARTUP_TIMEOUT</span> <span class="no">value</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">beq</span>         <span class="mi">2</span><span class="no">f</span>                      <span class="err">/</span><span class="p">*</span> <span class="no">if</span> <span class="no">HSE</span> <span class="no">doesn</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">start</span> <span class="p">-</span> <span class="no">remain</span> <span class="no">with</span> <span class="no">HSI</span> <span class="p">*</span><span class="err">/</span>
</span><span class='line'>    <span class="nf">and</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">RCC_CFGR_SWS</span>
</span><span class='line'>    <span class="nf">cmp</span>         <span class="no">r1</span><span class="p">,</span> <span class="no">SWS0</span>
</span><span class='line'>    <span class="nf">bne</span>         <span class="mi">1</span><span class="no">b</span>
</span><span class='line'><span class="err">2:</span>
</span><span class='line'>    <span class="nf">bx</span>          <span class="no">lr</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">init_clock</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">init_clock</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="na">.section</span>        <span class="no">.int_vector_table</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="err">%</span><span class="no">progbits</span>
</span><span class='line'>    <span class="na">.type</span>       <span class="no">basic_vectors</span><span class="p">,</span> <span class="err">%</span><span class="no">object</span>
</span><span class='line'><span class="nl">basic_vectors:</span>
</span><span class='line'>    <span class="na">.word</span>       <span class="no">_estack</span>
</span><span class='line'>    <span class="na">.word</span>       <span class="no">_reset</span>
</span><span class='line'>    <span class="na">.org</span>        <span class="mi">0x58</span>
</span><span class='line'>    <span class="na">.word</span>       <span class="no">_exti_0</span>
</span><span class='line'>    <span class="na">.size</span>       <span class="no">basic_vectors</span><span class="p">,</span> <span class="p">.</span> <span class="p">-</span> <span class="no">basic_vectors</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span> (registers_and_bits.inc.S)</span> <a href='/public/code/external_interrupt/registers_and_bits.inc.S'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='Gas'><span class='line'>    <span class="na">.equ</span>        <span class="no">RCC_BASE</span><span class="p">,</span>       <span class="mi">0x40023800</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">RCC_CR</span>  <span class="p">,</span>       <span class="no">RCC_BASE</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">RCC_CFGR</span><span class="p">,</span>       <span class="no">RCC_BASE</span> <span class="err">+</span> <span class="mi">0x08</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">RCC_PLLCFGR</span><span class="p">,</span>    <span class="no">RCC_BASE</span> <span class="err">+</span> <span class="mi">0x04</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">RCC_AHB1ENR</span><span class="p">,</span>    <span class="no">RCC_BASE</span> <span class="err">+</span> <span class="mi">0x30</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">RCC_APB2ENR</span><span class="p">,</span>    <span class="no">RCC_BASE</span> <span class="err">+</span> <span class="mi">0x44</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">RCC_CIR</span><span class="p">,</span>        <span class="no">RCC_BASE</span> <span class="err">+</span> <span class="mi">0x0C</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIOD_BASE</span><span class="p">,</span>     <span class="mi">0x40020C00</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIOD_MODER</span><span class="p">,</span>    <span class="no">GPIOD_BASE</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIOD_ODR</span><span class="p">,</span>      <span class="no">GPIOD_BASE</span> <span class="err">+</span> <span class="mi">0x14</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIOA_BASE</span><span class="p">,</span>     <span class="mi">0x40020000</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIOA_MODER</span><span class="p">,</span>    <span class="no">GPIOA_BASE</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIOA_PUPDR</span><span class="p">,</span>    <span class="no">GPIOA_BASE</span> <span class="err">+</span> <span class="mi">0x0C</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIOA_IDR</span><span class="p">,</span>      <span class="no">GPIOA_BASE</span> <span class="err">+</span> <span class="mi">0x10</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">SYSCFG_BASE</span><span class="p">,</span>    <span class="mi">0x40013800</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">SYSCFG_EXTICR1</span><span class="p">,</span> <span class="no">SYSCFG_BASE</span> <span class="err">+</span> <span class="mi">0x08</span>
</span><span class='line'>    <span class="no">.equ</span>        <span class="no">EXTI_BASE</span><span class="p">,</span>      <span class="mi">0x40013C00</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">EXTI_IMR</span><span class="p">,</span>       <span class="no">EXTI_BASE</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">EXTI_RTSR</span><span class="p">,</span>      <span class="no">EXTI_BASE</span> <span class="err">+</span> <span class="mi">0x08</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">EXTI_PR</span><span class="p">,</span>        <span class="no">EXTI_BASE</span> <span class="err">+</span> <span class="mi">0x14</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">NVIC_BASE</span><span class="p">,</span>      <span class="mi">0xE000E100</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">NVIC_ISER0</span><span class="p">,</span>     <span class="no">NVIC_BASE</span>
</span><span class='line'>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIODEN</span><span class="p">,</span>        <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">3</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIOAEN</span><span class="p">,</span>        <span class="mi">1</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">SYSCFGEN</span><span class="p">,</span>       <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">14</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">MODER12_OUT</span><span class="p">,</span>    <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">24</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">MODER13_OUT</span><span class="p">,</span>    <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">26</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">MODER14_OUT</span><span class="p">,</span>    <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">28</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">MODER15_OUT</span><span class="p">,</span>    <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">30</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">MODER0_IN</span><span class="p">,</span>      <span class="mi">0x3</span>
</span><span class='line'>    <span class="no">.equ</span>        <span class="no">LED_GREEN</span><span class="p">,</span>      <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">12</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">LED_ORANGE</span><span class="p">,</span>     <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">13</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">LED_RED</span><span class="p">,</span>        <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">14</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">LED_BLUE</span><span class="p">,</span>       <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">15</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">PLLON</span><span class="p">,</span>          <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">24</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">HSION</span><span class="p">,</span>          <span class="mi">1</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">HSEBYP</span><span class="p">,</span>         <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">18</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">HSEON</span><span class="p">,</span>          <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">16</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">HSERDY</span><span class="p">,</span>         <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">17</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">CSSON</span><span class="p">,</span>          <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">19</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">SW0</span><span class="p">,</span>            <span class="mi">1</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">SWS0</span><span class="p">,</span>           <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">2</span>
</span><span class='line'>    <span class="no">.equ</span>        <span class="no">PUPDR0_PD</span><span class="p">,</span>      <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="mi">1</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">IDR0</span><span class="p">,</span>           <span class="mi">1</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">MR0</span><span class="p">,</span>            <span class="mi">1</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">TR0</span><span class="p">,</span>            <span class="mi">1</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">PR0</span><span class="p">,</span>            <span class="mi">1</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">EXTI0_IRQn</span><span class="p">,</span>     <span class="mi">6</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">SETENA6</span><span class="p">,</span>        <span class="mi">1</span> <span class="err">&lt;&lt;</span> <span class="no">EXTI0_IRQn</span>
</span><span class='line'>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">HSE_STARTUP_TIMEOUT</span><span class="p">,</span>    <span class="mi">0x1</span>
</span><span class='line'>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">RCC_CFGR_SWS</span><span class="p">,</span>           <span class="mi">3</span> <span class="err">&lt;&lt;</span> <span class="mi">2</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">GPIOx_PUPDR0</span><span class="p">,</span>           <span class="mi">3</span>
</span><span class='line'>    <span class="na">.equ</span>        <span class="no">SYSCFG_EXTICR1_EXTI0</span><span class="p">,</span>   <span class="mi">0xF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ready executable: <a href="/public/code/external_interrupt/external_interrupt_1.bin">download</a>.</p>

<p>Note the stack usage in these examples. The routine preserves registers&#8217; contents by pushing it into the stack at the very start of execution and popping it before leave. I think that is absolutely necessary in interrupt handle routines because of randomity of accesses to them. Though, I may be wrong and there may be better aproaches to that.</p>

<p>Feel free to write for conversations.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dzianis Yatskevich</span></span>

      




<time class='entry-date' datetime='2014-12-30T08:26:35+03:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:26 am</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://denyadzi.github.io/blog/2014/12/30/triggering-external-interrupt-on-stm32f4discovery/" data-via="" data-counturl="http://denyadzi.github.io/blog/2014/12/30/triggering-external-interrupt-on-stm32f4discovery/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/12/28/stm32f4-168-mhz-speedup/" title="Previous Post: stm32f4 168 MHz speedup">&laquo; stm32f4 168 MHz speedup</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/01/02/plain-gcc-project-template-for-stm32f4xx/" title="Next Post: Plain gcc project workspace for stm32f4xx">Plain gcc project workspace for stm32f4xx &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/07/stm32f4-general-purpose-timers-assembly-programming/">Stm32f4 General Purpose Timers Assembly Programming</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/02/plain-gcc-project-template-for-stm32f4xx/">Plain Gcc Project Workspace for Stm32f4xx</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/30/triggering-external-interrupt-on-stm32f4discovery/">Triggering External Interrupt on Stm32f4discovery</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/28/stm32f4-168-mhz-speedup/">Stm32f4 168 MHz Speedup</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/27/clock-control-on-stm32f4discovery/">Clock Control on Stm32f4discovery</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>About me</h1>
  <p>I&#8217;m Dzianis from Belarus. My leading interest lays within computer science and involves studying and practicing both high and low level technologies.</p>
  <h1>Contacts</h1>
  <ul>
  If you need to contact - feel free and here are some adresses:
  <li><a href="mailto:den.overtone@gmail.com">den.overtone@gmail.com</a></li>
    <li><a href="https://www.facebook.com/dzianis.yadzi" target="_blank">Facebook</a></li>
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  2015 - by Dzianis Yatskevich -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58151682-1', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>
